COMPILER MAGIA

    const int // types
        undef = 0, number = 1, boolean = 2, text = 3, vertex = 4, edge = 5, setType = 10, list = 20, queue = 30, stack = 40;
    
    
	const int // object kinds
        var = 0, proc = 1;
    
    /*
	public SymbolTable   tab;
	public CodeGenerator gen;
    */
  
/*--------------------------------------------------------------------------*/
CHARACTERS
  letter = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".
  digit = "0123456789".
  cr  = '\r'.
  lf  = '\n'.
  tab = '\t'.
  CharInLine = ANY - '\r' - '\n'.
  AnyButDoubleQuote = CharInLine - '\"'.

TOKENS
  IDENT  = letter {letter | digit}.
  NUMBER = digit {digit} | digit {digit} '.' digit {digit}.
  TEXT = '"' {AnyButDoubleQuote | "\\\""} '"'.
  NONE = "none".
  TRUE = "true".
  FALSE = "false".
  
COMMENTS FROM "/*" TO "*/" NESTED
COMMENTS FROM "//" TO lf

IGNORE cr + lf + tab



PRODUCTIONS
/*------------------------------------------------------------------------*/
MAGIA 
    = {SYNC '[' Head ']'} {FuncDecl}.
    
/*------------------------------------------------------------------------*/
Head
    = ("vertex" | "edge") '(' AttrDecls ')'.

/*------------------------------------------------------------------------*/
AttrDecls
    = AttrDecl {WEAK ',' AttrDecl}.

/*------------------------------------------------------------------------*/
AttrDecl
    = Type IDENT ['=' Expr].

/*------------------------------------------------------------------------*/
FuncDecl
    = "func" IDENT '(' FuncParam ')'.

 /*------------------------------------------------------------------------*/
FuncParam
    = [HalfDecl {',' HalfDecl}].

/*------------------------------------------------------------------------*/
HalfDecl
    = Type IDENT.

/*------------------------------------------------------------------------*/


/*------------------------------------------------------------------------*/
Expr
    = ExprOR.
    
/*------------------------------------------------------------------------*/
ExprOR
    = ExprAnd {"||" ExprAnd}.

/*------------------------------------------------------------------------*/
ExprAnd
    = ExprEQ {"&&" ExprEQ}.

/*------------------------------------------------------------------------*/
ExprEQ
    = ExprRel [("==" | "!=") ExprRel].

/*------------------------------------------------------------------------*/
ExprRel
    = ExprPlus [('<' | '>' | "<=" | ">=") ExprPlus].

/*------------------------------------------------------------------------*/
ExprPlus
    = ['-'] ExprMult {('+' | '-') ExprMult}.

/*------------------------------------------------------------------------*/
ExprMult
    = ExprNot {('*' | '/' | '%') ExprNot}.

/*------------------------------------------------------------------------*/
ExprNot
    = ['!'] Factor.

/*------------------------------------------------------------------------*/
Factor
    = '(' Expr ')' | Const | CallOrID.

/*------------------------------------------------------------------------*/
CallOrID
    = IDENT ['(' Args ')'].

/*------------------------------------------------------------------------*/
Args
    = [Expr {WEAK ',' Expr}].

/*------------------------------------------------------------------------*/
Const
    = NUMBER
    | TEXT
    | TRUE
    | FALSE
    | NONE.

/*------------------------------------------------------------------------*/
Type
    = SingleType
    | CollecType.

/*------------------------------------------------------------------------*/
CollecType
    = "list" WEAK '<' SingleType WEAK '>'
    | "set" WEAK '<' SingleType WEAK '>'
    | "queue" WEAK '<' SingleType WEAK '>'
    | "stack" WEAK '<' SingleType WEAK '>'.

/*------------------------------------------------------------------------*/
SingleType
    = "number"
    | "bool"
    | "text"
    | "vertex"
    | "edge".
/*------------------------------------------------------------------------*/

END MAGIA.
